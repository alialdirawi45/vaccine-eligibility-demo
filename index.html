<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vaccine Eligibility Tool ‚Äì Preliminary Code (Updated)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #0f172a;
      --bg-soft: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --accent-strong: #4ade80;
      --danger: #f97373;
      --border-subtle: #1f2937;
      --border-strong: #374151;
      --pill-bg: #020617;
      --pill-border: #4b5563;
      --card-radius: 14px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.75);
      --shadow-subtle: 0 10px 30px rgba(15, 23, 42, 0.6);
      --chip-bg: rgba(15, 23, 42, 0.9);
      --chip-border: #4b5563;
      --tab-bg-active: #111827;
      --tab-bg: #020617;
      --tab-border-active: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .page-shell {
      width: 100%;
      max-width: 1220px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .app-card {
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18) 0, transparent 50%),
                  radial-gradient(circle at 100% 0, rgba(56, 189, 248, 0.16) 0, transparent 55%),
                  linear-gradient(145deg, #020617 0, #020617 46%, #020617 100%);
      border-radius: 26px;
      padding: 22px 22px 20px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(20px);
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title-stack h1 {
      margin: 0 0 4px;
      font-size: 21px;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 11px;
      padding: 2px 9px;
      border-radius: 999px;
      border: 1px solid rgba(52, 211, 153, 0.6);
      background: radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.22), transparent 60%);
      color: var(--accent-strong);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .title-stack p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .chip {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .badge-row {
        justify-content: flex-start;
      }
    }

    .panel {
      background: radial-gradient(circle at 0 0, rgba(15, 23, 42, 0.7) 0, rgba(15, 23, 42, 0.98) 52%, #020617 100%);
      border-radius: var(--card-radius);
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: var(--shadow-subtle);
      padding: 14px 14px 12px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top left, rgba(34, 197, 94, 0.06), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.04), transparent 55%);
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
    }

    .panel-header h2 {
      margin: 0;
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .panel-kicker {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
    }

    .panel-subtitle {
      margin: 2px 0 0;
      font-size: 11px;
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      gap: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    label {
      font-size: 11px;
      color: var(--muted);
    }

    .required-dot {
      color: var(--accent-strong);
      margin-left: 2px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 9px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text);
      font-size: 12px;
      outline: none;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
    }

    .checkbox-cluster {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 6px 8px;
      margin-top: 2px;
    }

    @media (max-width: 640px) {
      .checkbox-cluster {
        grid-template-columns: 1fr;
      }
    }

    .checkbox-row {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .checkbox-row input[type="checkbox"] {
      margin-top: 2px;
      accent-color: var(--accent);
    }

    .helper-text {
      font-size: 10px;
      color: var(--muted);
      margin-top: 2px;
    }

    .actions-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 10px;
    }

    .button-primary {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: radial-gradient(circle at 0 0, rgba(74, 222, 128, 0.2) 0, transparent 55%),
                  linear-gradient(135deg, #22c55e, #16a34a, #22c55e);
      color: #022c22;
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.55);
      position: relative;
      overflow: hidden;
    }

    .button-primary span.icon {
      font-size: 14px;
    }

    .button-primary:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(34, 197, 94, 0.5);
    }

    .button-ghost {
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 5px 10px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      background: transparent;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .button-ghost span.icon {
      font-size: 13px;
    }

    .tab-bar {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 3px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.85);
    }

    .tab-button {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 5px 10px;
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      background: transparent;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      position: relative;
    }

    .tab-button span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.7);
    }

    .tab-button.active {
      background: var(--tab-bg-active);
      color: #e5e7eb;
      border-color: var(--tab-border-active);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
    }

    .tab-button.active span.dot {
      background: var(--accent);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.85);
    }

    .print-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
      margin-top: 8px;
    }

    .print-button {
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      padding: 4px 9px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }

    .print-button span.icon {
      font-size: 11px;
    }

    .results-shell {
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at 0 0, rgba(15, 23, 42, 0.98), #020617);
      padding: 10px 11px 10px;
      max-height: 540px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .results-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
    }

    .results-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .results-scroll::-webkit-scrollbar-track {
      background: #020617;
    }

    .results-scroll::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .results-meta {
      font-size: 10px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .results-meta strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .tab-panel {
      display: none;
      font-size: 12px;
      line-height: 1.5;
    }

    .tab-panel.active {
      display: block;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      padding: 3px 8px;
      font-size: 10px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin: 0 0 6px;
    }

    .vaccine-block {
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.85);
      background: rgba(15, 23, 42, 0.75);
      padding: 8px 9px;
      margin-bottom: 8px;
    }

    .vaccine-block-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .vaccine-block-header h3 {
      margin: 0;
      font-size: 13px;
    }

    .tag {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(34, 197, 94, 0.7);
      color: var(--accent-strong);
      background: rgba(22, 163, 74, 0.12);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .tag-muted {
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.85);
    }

    .vaccine-block p {
      margin: 3px 0;
      font-size: 11px;
      color: #e5e7eb;
    }

    .vaccine-block .meta {
      font-size: 10px;
      color: var(--muted);
      margin-top: 4px;
    }

    .indication-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 11px;
    }

    .indication-table th,
    .indication-table td {
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 6px 6px;
      vertical-align: top;
    }

    .indication-table th {
      background: #020617;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
    }

    .indication-table td strong {
      color: #e5e7eb;
    }

    .ref {
      font-size: 9px;
      color: var(--muted);
      margin-top: 4px;
    }

    .empty-state {
      font-size: 11px;
      color: var(--muted);
      padding: 8px 6px;
      border-radius: 8px;
      border: 1px dashed rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.6);
      margin-top: 4px;
    }

    .danger-text {
      color: var(--danger);
    }

    @media print {
      body {
        background: #fff;
      }
      .page-shell {
        margin: 0;
        padding: 0;
      }
      .app-card {
        box-shadow: none;
        border-radius: 0;
        border: none;
        background: #fff;
      }
      .header-row,
      .panel,
      .panel-header,
      .actions-row,
      .badge-row,
      .button-primary,
      .button-ghost,
      .tab-bar,
      .print-row {
        display: none !important;
      }
      .layout {
        display: block;
      }
      .results-shell {
        max-height: none;
        border: none;
        padding: 0;
      }
      .tab-panel {
        display: none !important;
      }
      .tab-panel.print-target {
        display: block !important;
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <div class="app-card">
      <div class="header-row">
        <div class="title-stack">
          <div style="display:flex; align-items:center; gap:8px;">
            <h1>Vaccine Eligibility Tool</h1>
            <span class="title-pill">Preliminary</span>
          </div>
          <p>Quickly triage adult vaccine needs, then drill into NACI indication, recommendation, and Ontario coverage.</p>
        </div>
        <div class="badge-row">
          <div class="chip">
            <span class="chip-dot"></span>
            NACI-aligned logic (adult focus)
          </div>
          <div class="chip">
            üßæ Per-vaccine indication / coverage
          </div>
          <div class="chip">
            üñ® Separate print views by tab
          </div>
        </div>
      </div>

      <div class="layout">
        <!-- LEFT: PATIENT INPUT -->
        <div class="panel">
          <div class="panel-inner">
            <div class="panel-header">
              <div>
                <div class="panel-kicker">Patient Profile</div>
                <p class="panel-subtitle">Enter the basics + risk factors (adult-focused; Ontario coverage assumptions).</p>
              </div>
              <button type="button" class="button-ghost" id="reset-form-btn">
                <span class="icon">‚Ü∫</span> Reset
              </button>
            </div>

            <form id="eligibility-form">
              <div class="form-grid">
                <div class="field-row">
                  <div class="field">
                    <label for="age">Age<span class="required-dot">*</span></label>
                    <input type="number" id="age" min="0" max="120" placeholder="e.g., 68" required />
                    <div class="helper-text">Tool is optimized for adults (‚â•18 years).</div>
                  </div>
                  <div class="field">
                    <label for="province">Province (for coverage)</label>
                    <select id="province">
                      <option value="ON" selected>Ontario</option>
                      <option value="Other">Other / Unknown</option>
                    </select>
                    <div class="helper-text">Coverage logic currently tuned to Ontario public programs.</div>
                  </div>
                </div>

                <div class="field">
                  <label>Key risk factors (simplified)</label>
                  <div class="checkbox-cluster">
                    <label class="checkbox-row">
                      <input type="checkbox" id="highRiskMedical" />
                      <span>Chronic cardiac, pulmonary, renal, hepatic, metabolic disease, or other high-risk medical conditions.</span>
                    </label>
                    <label class="checkbox-row">
                      <input type="checkbox" id="immunocompromised" />
                      <span>Immunocompromised / immunosuppressed (disease or therapy).</span>
                    </label>
                    <label class="checkbox-row">
                      <input type="checkbox" id="ltcResident" />
                      <span>Lives in nursing home / other chronic care facility.</span>
                    </label>
                    <label class="checkbox-row">
                      <input type="checkbox" id="pregnant" />
                      <span>Pregnant (or will be in late pregnancy during RSV / flu season).</span>
                    </label>
                  </div>
                  <div class="helper-text">
                    These toggles drive higher-risk logic for pneumococcal, RSV, shingles, flu, and COVID-19.
                  </div>
                </div>

                <div class="field">
                  <label>Sexual health / HPV considerations (optional)</label>
                  <div class="checkbox-cluster">
                    <label class="checkbox-row">
                      <input type="checkbox" id="hpvHighRisk" />
                      <span>High-risk sexual exposure (multiple partners, MSM, etc.).</span>
                    </label>
                    <label class="checkbox-row">
                      <input type="checkbox" id="hpvIncompleteSeries" />
                      <span>HPV series incomplete or unknown, ‚â§26 years old.</span>
                    </label>
                  </div>
                  <div class="helper-text">
                    HPV logic assumes NACI catch-up focus to ~26 years; some adults up to 45 may still benefit.
                  </div>
                </div>
              </div>

              <div class="actions-row">
                <button type="submit" class="button-primary">
                  <span class="icon">‚öôÔ∏è</span>
                  <span>Get Results</span>
                </button>
                <button type="button" class="button-ghost" id="clear-results-btn">
                  <span class="icon">üßπ</span>
                  Clear results only
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- RIGHT: RESULTS -->
        <div class="panel">
          <div class="panel-inner">
            <div class="panel-header">
              <div>
                <div class="panel-kicker">Results</div>
                <p class="panel-subtitle">
                  Quick triage, detailed counselling notes, and a dedicated
                  <strong>Indication &amp; Coverage</strong> view per vaccine.
                </p>
              </div>
              <div class="tab-bar" id="tab-bar">
                <button class="tab-button active" data-tab="quick-summary">
                  <span class="dot"></span>
                  Quick
                </button>
                <button class="tab-button" data-tab="detailed-summary">
                  <span class="dot"></span>
                  Detailed
                </button>
                <button class="tab-button" data-tab="indication-coverage">
                  <span class="dot"></span>
                  Indication &amp; Coverage
                </button>
              </div>
            </div>

            <div class="print-row">
              <button type="button" class="print-button" data-print-tab="quick-summary">
                <span class="icon">üñ®</span> Print Quick
              </button>
              <button type="button" class="print-button" data-print-tab="detailed-summary">
                <span class="icon">üñ®</span> Print Detailed
              </button>
              <button type="button" class="print-button" data-print-tab="indication-coverage">
                <span class="icon">üñ®</span> Print Indication / Coverage
              </button>
            </div>

            <div class="results-shell">
              <div class="results-meta" id="results-meta">
                <span>Waiting for input‚Ä¶</span>
                <span></span>
              </div>
              <div class="results-scroll">
                <div id="quick-summary" class="tab-panel active">
                  <div class="pill-row">
                    <div class="pill">
                      <span class="dot"></span>
                      Prioritized: Prevnar / Shingrix / RSV ‚Üí Flu / COVID ‚Üí HPV / Tdap
                    </div>
                    <div class="pill">
                      ‚ÑπÔ∏è Summary shows only vaccines
                      <strong>recommended today</strong>.
                    </div>
                  </div>
                  <div id="quick-summary-content" class="tab-body"></div>
                </div>

                <div id="detailed-summary" class="tab-panel">
                  <div class="pill-row">
                    <div class="pill">
                      <span class="dot"></span>
                      Detailed counselling notes by vaccine.
                    </div>
                    <div class="pill">
                      No duplicate entries for public vs private funding.
                    </div>
                  </div>
                  <div id="detailed-summary-content" class="tab-body"></div>
                </div>

                <div id="indication-coverage" class="tab-panel">
                  <p class="helper-text" style="margin-bottom:6px;">
                    This view separates:
                    <strong>indication</strong> (who the vaccine is for),
                    <strong>recommendation</strong> (NACI strength for this patient),
                    and <strong>coverage</strong> (Ontario public vs private pay).
                  </p>
                  <div id="indication-coverage-content" class="tab-body"></div>
                </div>
              </div>
            </div>

            <div class="ref" style="margin-top:8px;">
              NACI sources include: Canadian Immunization Guide chapters (pneumococcal, herpes zoster, RSV, influenza) and recent
              statements (seasonal influenza, adult pneumococcal, zoster, RSV). Always verify against the latest guidance and
              local Ontario program bulletins before making funding decisions.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Data model + NACI-aligned logic (simplified, adult-focused) ---

    const vaccines = [
      {
        id: "pcv20",
        name: "Pneumococcal (PCV20 ‚Äì Prevnar 20)",
        group: 1, // ordering: 1 = Prevnar/Shingrix/RSV
        naciRef:
          "NACI / Canadian Immunization Guide ‚Äì Pneumococcal Vaccine chapter; adult summary.",
        isIndicated(patient) {
          return patient.age >= 18;
        },
        isRecommended(patient) {
          return patient.age >= 65 || (patient.age >= 18 && patient.highRiskMedical);
        },
        indicationText(patient) {
          return (
            "Indicated for adults 18 years and older to prevent invasive pneumococcal disease; " +
            "programs focus on ‚â•65 years and adults 18‚Äì64 with high-risk conditions."
          );
        },
        recommendationText(patient) {
          if (patient.age >= 65) {
            return "Strongly recommended: adult ‚â•65 years (program-wide recommendation).";
          }
          if (patient.age >= 18 && patient.highRiskMedical) {
            return "Recommended: adult 18‚Äì64 with high-risk medical conditions (e.g., chronic heart/lung disease, CKD, etc.).";
          }
          if (patient.age >= 18) {
            return "Not routinely recommended for healthy adult <65 without specific risk factors; consider shared decision-making.";
          }
          return "Primarily an adult-focused recommendation; refer to pediatric guidance if applicable.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          const eligibleProgram = patient.age >= 65 || (patient.age >= 18 && patient.highRiskMedical);
          if (inON && eligibleProgram) {
            return {
              type: "public",
              text:
                "Likely publicly funded in Ontario for this patient (adult ‚â•65 or 18‚Äì64 with qualifying high-risk condition), " +
                "subject to local vaccine program details and formularies."
            };
          }
          if (inON) {
            return {
              type: "private",
              text:
                "Not routinely publicly funded in Ontario for a healthy adult <65 without high-risk conditions; usually private pay/out-of-pocket."
            };
          }
          return {
            type: "unknown",
            text:
              "Coverage depends on local provincial/territorial program; often publicly funded for ‚â•65 and selected high-risk adults, otherwise private pay."
          };
        },
        quickSummary(patient) {
          if (this.isRecommended(patient)) {
            return "Recommended pneumococcal conjugate dose (PCV20) based on age/risk; ideally given once and documented.";
          }
          return "Not routinely required today for this patient; consider later if they age into program or develop risk factors.";
        },
        detailedSummary(patient) {
          if (this.isRecommended(patient)) {
            return (
              "Offer a single dose of PCV20 to protect against invasive pneumococcal disease. " +
              "Administer IM and ensure spacing from any previous polysaccharide doses is appropriate. " +
              "Document product, lot, and site, and counsel on common local reactions (pain, redness, mild systemic symptoms)."
            );
          }
          return (
            "PCV20 is licensed for adults 18+, but routine use is targeted to ‚â•65 years and high-risk adults. " +
            "For a healthy adult <65 with no major comorbidities, routine immunization is generally not required; " +
            "reassess if they become eligible through age or new high-risk conditions."
          );
        }
      },
      {
        id: "shingrix",
        name: "Herpes Zoster (RZV ‚Äì Shingrix)",
        group: 1,
        naciRef:
          "NACI updated recommendations on herpes zoster vaccination (recombinant zoster vaccine).",
        isIndicated(patient) {
          return patient.age >= 50 || (patient.age >= 18 && patient.immunocompromised);
        },
        isRecommended(patient) {
          return patient.age >= 50 || (patient.age >= 18 && patient.immunocompromised);
        },
        indicationText(patient) {
          return (
            "Indicated for adults ‚â•50 years and adults ‚â•18 years at increased risk of herpes zoster due to immunodeficiency or immunosuppression."
          );
        },
        recommendationText(patient) {
          if (patient.age >= 50) {
            return "Strongly recommended: 2-dose RZV series for adults ‚â•50 years (even if they had shingles or prior live zoster vaccine).";
          }
          if (patient.age >= 18 && patient.immunocompromised) {
            return "Recommended: 2-dose RZV series for immunocompromised adults ‚â•18 years at increased risk of herpes zoster.";
          }
          return "Not routinely recommended in this age/risk group.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (inON && patient.age >= 65 && patient.age <= 70) {
            return {
              type: "public",
              text:
                "Publicly funded in Ontario for adults 65‚Äì70 years (2-dose series), subject to current provincial program criteria."
            };
          }
          if (inON) {
            return {
              type: "private",
              text:
                "Outside the 65‚Äì70-year funded cohort, Shingrix is usually private pay/out-of-pocket, though some patients may have third-party coverage."
            };
          }
          return {
            type: "unknown",
            text:
              "Coverage varies by jurisdiction; many provinces publicly fund for selected older adults, while others require private/third-party payment."
          };
        },
        quickSummary(patient) {
          if (this.isRecommended(patient)) {
            return "Recommend a 2-dose Shingrix series, separated by 2‚Äì6 months, to reduce shingles and post-herpetic neuralgia risk.";
          }
          return "Shingles vaccine is not routinely required in this age/risk group today; reassess as the patient ages or if risk changes.";
        },
        detailedSummary(patient) {
          if (this.isRecommended(patient)) {
            return (
              "Provide recombinant zoster vaccine (Shingrix) as a 2-dose series (0 and 2‚Äì6 months). " +
              "Counsel about local injection-site reactions and systemic symptoms (fever, myalgias) that typically resolve within 2‚Äì3 days. " +
              "Document immunization status, schedule the second dose, and review that vaccination reduces both shingles incidence and post-herpetic neuralgia."
            );
          }
          return (
            "RZV is indicated mainly for adults ‚â•50 and immunocompromised adults ‚â•18. " +
            "In younger, immunocompetent adults without major risk factors, routine zoster vaccination is not necessary at this time."
          );
        }
      },
      {
        id: "rsv",
        name: "RSV (Arexvy / Abrysvo / other adult RSV vaccines)",
        group: 1,
        naciRef:
          "NACI guidance on RSV vaccines for older adults; Canadian Immunization Guide RSV content.",
        isIndicated(patient) {
          return patient.age >= 60 || (patient.age >= 50 && patient.highRiskMedical);
        },
        isRecommended(patient) {
          return (
            patient.age >= 75 ||
            (patient.age >= 60 && (patient.highRiskMedical || patient.ltcResident))
          );
        },
        indicationText(patient) {
          return (
            "Indicated for older adults (typically ‚â•60 years), and some high-risk adults 50‚Äì59 years depending on product and jurisdiction."
          );
        },
        recommendationText(patient) {
          if (patient.age >= 75) {
            return "Strongly recommended: adults ‚â•75 years, especially with chronic conditions, when vaccine is available.";
          }
          if (patient.age >= 60 && (patient.highRiskMedical || patient.ltcResident)) {
            return "Recommended: adults ‚â•60 with significant chronic conditions or living in long-term care/chronic care settings.";
          }
          if (patient.age >= 60) {
            return "May be considered on a case-by-case basis for adults 60‚Äì74 after discussion of risks, benefits, and local epidemiology.";
          }
          if (patient.age >= 50 && patient.highRiskMedical) {
            return "May be considered for some high-risk 50‚Äì59-year-olds if product and program criteria support it.";
          }
          return "Not routinely recommended in this age group.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (
            inON &&
            ((patient.age >= 75) ||
              (patient.age >= 60 && patient.ltcResident))
          ) {
            return {
              type: "public",
              text:
                "Ontario‚Äôs high-risk RSV program focuses on adults ‚â•75 and high-risk or long-term care residents ‚â•60; " +
                "this patient likely qualifies for a publicly funded dose if other clinical criteria are met."
            };
          }
          if (inON) {
            return {
              type: "private",
              text:
                "Outside high-risk older adult groups, RSV vaccine is usually private pay or not routinely offered; " +
                "check current Ontario program bulletins for exact eligibility."
            };
          }
          return {
            type: "unknown",
            text:
              "Coverage is jurisdiction-dependent; many programs target the oldest and highest-risk adults, with others paying privately."
          };
        },
        quickSummary(patient) {
          if (this.isRecommended(patient)) {
            return "Recommend an RSV vaccine dose this season due to age and/or high-risk status to reduce RSV-associated lower respiratory tract disease.";
          }
          if (this.isIndicated(patient)) {
            return "Eligible for RSV vaccination; consider shared decision-making based on age, comorbidities, and local program/funding.";
          }
          return "RSV vaccination is not routinely indicated at this time based on current age/risk inputs.";
        },
        detailedSummary(patient) {
          if (this.isRecommended(patient)) {
            return (
              "Discuss RSV vaccination as a one-time dose (product-specific) to reduce severe RSV outcomes. " +
              "Prioritize adults ‚â•75 and those ‚â•60 in long-term care or with significant chronic conditions. " +
              "Counsel on expected local/systemic reactions and coordinate timing with other seasonal vaccines if appropriate."
            );
          }
          return (
            "RSV vaccines are primarily aimed at older and high-risk adults. " +
            "For this patient, focus on influenza and COVID-19 vaccination first; RSV vaccination may still be considered in future years as they age or if risk profile changes."
          );
        }
      },
      {
        id: "flu",
        name: "Seasonal Influenza",
        group: 2, // Flu / COVID
        naciRef:
          "NACI Statement on Seasonal Influenza Vaccine; Canadian Immunization Guide ‚Äì Influenza chapter.",
        isIndicated(patient) {
          return patient.age >= 0.5;
        },
        isRecommended(patient) {
          return patient.age >= 0.5;
        },
        indicationText(patient) {
          return "Indicated for almost everyone ‚â•6 months of age; annual vaccination is the norm in Canada.";
        },
        recommendationText(patient) {
          if (patient.age >= 65) {
            return "Strongly recommended annually; older adults should preferentially receive high-dose, adjuvanted, or recombinant products when available.";
          }
          if (patient.highRiskMedical || patient.pregnant) {
            return "Strongly recommended annually for patients with chronic conditions and those who are pregnant.";
          }
          return "Recommended annually for all individuals ‚â•6 months; focus on timing before or early in flu season.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (inON) {
            return {
              type: "public",
              text:
                "Universal publicly funded program in Ontario for individuals ‚â•6 months; product choice (e.g., high-dose) may depend on age and risk."
            };
          }
          return {
            type: "public",
            text:
              "Most Canadian jurisdictions fund seasonal influenza vaccine for all (or nearly all) residents; confirm details locally."
          };
        },
        quickSummary(patient) {
          return "Recommend an age-appropriate influenza vaccine this season (can be co-administered with other inactivated vaccines).";
        },
        detailedSummary(patient) {
          return (
            "Offer an age-appropriate, inactivated or recombinant influenza vaccine annually before or during the flu season. " +
            "Adults ‚â•65 often benefit from high-dose, adjuvanted, or recombinant formulations when available. " +
            "Counsel on common local and systemic reactions and reinforce annual vaccination due to antigenic drift."
          );
        }
      },
      {
        id: "covid",
        name: "COVID-19 (updated formulation)",
        group: 2,
        naciRef:
          "NACI COVID-19 vaccine statements ‚Äì updated monovalent formulations recommended seasonally.",
        isIndicated(patient) {
          return patient.age >= 6;
        },
        isRecommended(patient) {
          return patient.age >= 18;
        },
        indicationText(patient) {
          return "Indicated for most individuals ‚â•6 months, with updated formulations recommended seasonally.";
        },
        recommendationText(patient) {
          if (patient.age >= 65 || patient.highRiskMedical || patient.immunocompromised) {
            return "Strongly recommended to receive the current season‚Äôs updated COVID-19 vaccine dose.";
          }
          if (patient.age >= 18) {
            return "Recommended to receive at least the current season‚Äôs updated dose, especially if not vaccinated recently.";
          }
          return "For children/adolescents, follow age-specific NACI schedules and local guidance.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (inON) {
            return {
              type: "public",
              text:
                "COVID-19 vaccines are publicly funded in Ontario for eligible age and risk groups; updated products are typically available seasonally without out-of-pocket cost."
            };
          }
          return {
            type: "public",
            text:
              "In most Canadian jurisdictions, COVID-19 vaccination is publicly funded; confirm current eligibility where the patient lives."
          };
        },
        quickSummary(patient) {
          return "Recommend the current season‚Äôs updated COVID-19 vaccine dose, especially if last dose was ‚â•6‚Äì12 months ago or the patient is high risk.";
        },
        detailedSummary(patient) {
          return (
            "Review prior COVID-19 doses and infection history, then offer an updated monovalent product according to the latest NACI schedule. " +
            "Counsel about local/systemic reactions and reinforce that vaccination reduces severe disease, hospitalization, and death."
          );
        }
      },
      {
        id: "hpv",
        name: "HPV (Gardasil 9 or equivalent)",
        group: 3, // HPV / Tdap
        naciRef:
          "NACI HPV vaccine statements; Canadian Immunization Guide ‚Äì HPV chapter.",
        isIndicated(patient) {
          return patient.age >= 9 && patient.age <= 45;
        },
        isRecommended(patient) {
          return (
            (patient.age >= 9 && patient.age <= 26) ||
            (patient.age <= 45 && patient.hpvHighRisk)
          );
        },
        indicationText(patient) {
          return (
            "Indicated from age 9; strongest evidence and public programs target adolescents and young adults, " +
            "with catch-up typically up to about 26 years and selective use up to 45 years."
          );
        },
        recommendationText(patient) {
          if (patient.age >= 9 && patient.age <= 26) {
            return "Recommended as a 2- or 3-dose series for adolescents and young adults up to about 26 years (dose schedule depends on age at start).";
          }
          if (patient.age <= 45 && patient.hpvHighRisk) {
            return "May be considered up to age 45 in individuals with high-risk sexual exposure after shared decision-making.";
          }
          return "Not routinely recommended at this age without specific high-risk indications.";
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (inON && patient.age >= 9 && patient.age <= 18) {
            return {
              type: "public",
              text:
                "Likely publicly funded via Ontario school-based or catch-up programs for eligible adolescents; confirm exact grade/age criteria."
            };
          }
          if (inON && patient.age <= 26 && patient.hpvIncompleteSeries) {
            return {
              type: "mixed",
              text:
                "Some catch-up opportunities may be publicly funded; otherwise, doses are usually private pay/third-party. Check Ontario program details."
            };
          }
          return {
            type: "private",
            text:
              "In adult pharmacy practice, HPV vaccination is often private pay (or covered by private insurance), especially beyond standard school program ages."
          };
        },
        quickSummary(patient) {
          if (this.isRecommended(patient)) {
            return "Consider (or complete) an HPV vaccine series, especially given age and/or high-risk sexual exposure.";
          }
          return "HPV vaccine is typically given earlier in life; may not be routinely required at this age unless there are specific high-risk indications.";
        },
        detailedSummary(patient) {
          if (this.isRecommended(patient)) {
            return (
              "HPV vaccination reduces risk of HPV-related cancers and genital warts. " +
              "Offer or complete the vaccine series based on age at initiation (2-dose vs 3-dose schedule). " +
              "Review previous HPV doses, sexual health risks, and public vs private coverage options."
            );
          }
          return (
            "HPV vaccine is ideally given in adolescence. " +
            "For older adults without major risk factors, the incremental benefit is smaller; discuss case-by-case if the patient is particularly concerned or at higher risk."
          );
        }
      },
      {
        id: "tdap",
        name: "Tdap / Td (Tetanus, Diphtheria, Pertussis)",
        group: 3,
        naciRef:
          "NACI tetanus, diphtheria, and pertussis recommendations; Canadian Immunization Guide.",
        isIndicated(patient) {
          return patient.age >= 18;
        },
        isRecommended(patient) {
          return patient.age >= 18;
        },
        indicationText(patient) {
          return (
            "All adults should receive at least one dose of Tdap, then Td boosters every 10 years; " +
            "pregnant individuals should receive Tdap in every pregnancy (usually in late 2nd or 3rd trimester)."
          );
        },
        recommendationText(patient) {
          if (patient.pregnant) {
            return "Recommended Tdap in each pregnancy (preferably between 27‚Äì32 weeks) to protect the newborn from pertussis.";
          }
          return (
            "Ensure at least one adult Tdap dose, then Td boosters every 10 years. " +
            "If history is unknown or last dose ‚â•10 years ago, a booster is recommended."
          );
        },
        coverage(patient) {
          const inON = patient.province === "ON";
          if (inON) {
            return {
              type: "public",
              text:
                "Tetanus/diphtheria/pertussis vaccines are part of publicly funded immunization in Ontario; " +
                "administration site (physician/public health vs pharmacy) may influence billing, not patient funding."
            };
          }
          return {
            type: "public",
            text:
              "In most jurisdictions, Tdap/Td vaccines are publicly funded as part of the routine immunization schedule; verify local delivery models."
          };
        },
        quickSummary(patient) {
          return (
            "Confirm when the last tetanus/pertussis booster was given. " +
            "If ‚â•10 years ago or unknown, a Tdap/Td booster is recommended; in pregnancy, give Tdap in each pregnancy."
          );
        },
        detailedSummary(patient) {
          return (
            "Review immunization history. If the patient never received Tdap as an adult, give a Tdap dose now, then Td boosters every 10 years. " +
            "In pregnancy, administer Tdap in each pregnancy (preferably at 27‚Äì32 weeks) to optimize passive protection for the infant. " +
            "Counsel on local injection-site reactions and document dosing history."
          );
        }
      }
    ];

    function getPatientFromForm() {
      const age = parseInt(document.getElementById("age").value, 10) || 0;
      const province = document.getElementById("province").value;
      const highRiskMedical = document.getElementById("highRiskMedical").checked;
      const immunocompromised = document.getElementById("immunocompromised").checked;
      const ltcResident = document.getElementById("ltcResident").checked;
      const pregnant = document.getElementById("pregnant").checked;
      const hpvHighRisk = document.getElementById("hpvHighRisk").checked;
      const hpvIncompleteSeries = document.getElementById("hpvIncompleteSeries").checked;

      return {
        age,
        province,
        highRiskMedical,
        immunocompromised,
        ltcResident,
        pregnant,
        hpvHighRisk,
        hpvIncompleteSeries
      };
    }

    function evaluateVaccines(patient) {
      const evaluated = [];

      vaccines.forEach((v) => {
        const indicated = v.isIndicated(patient);
        const recommended = v.isRecommended(patient);
        const coverage = v.coverage(patient);

        if (indicated || recommended) {
          evaluated.push({
            id: v.id,
            name: v.name,
            group: v.group,
            indicated,
            recommended,
            indicationText: v.indicationText(patient),
            recommendationText: v.recommendationText(patient),
            coverageType: coverage.type,
            coverageText: coverage.text,
            naciRef: v.naciRef,
            quickSummary: v.quickSummary(patient),
            detailedSummary: v.detailedSummary(patient)
          });
        }
      });

      evaluated.sort((a, b) => {
        if (a.group !== b.group) return a.group - b.group;
        return a.name.localeCompare(b.name);
      });

      return evaluated;
    }

    function renderMeta(patient, results) {
      const metaEl = document.getElementById("results-meta");
      if (!patient || !results) {
        metaEl.innerHTML = "<span>Waiting for input‚Ä¶</span><span></span>";
        return;
      }

      const recommendedCount = results.filter((r) => r.recommended).length;

      metaEl.innerHTML = `
        <span>
          Age <strong>${patient.age || "?"}</strong> ¬∑ Province <strong>${patient.province}</strong>
          ${
            patient.highRiskMedical || patient.immunocompromised || patient.ltcResident || patient.pregnant
              ? "¬∑ High-risk flags present"
              : ""
          }
        </span>
        <span>
          <strong>${recommendedCount}</strong> vaccine${recommendedCount === 1 ? "" : "s"} recommended today
        </span>
      `;
    }

    function renderQuickSummary(results) {
      const container = document.getElementById("quick-summary-content");
      if (!results.length) {
        container.innerHTML = `
          <div class="empty-state">
            Enter patient details and click <strong>Get Results</strong> to see vaccine recommendations.
          </div>
        `;
        return;
      }

      const recommended = results.filter((r) => r.recommended);
      if (!recommended.length) {
        container.innerHTML = `
          <div class="empty-state">
            No vaccines are strongly recommended today based on the limited inputs captured here. 
            Use clinical judgment and full guidelines to reassess.
          </div>
        `;
        return;
      }

      let html = '<div class="section-title">Recommended today</div>';
      recommended.forEach((r) => {
        html += `
          <div class="vaccine-block">
            <div class="vaccine-block-header">
              <h3>${r.name}</h3>
              <span class="tag">Recommended</span>
            </div>
            <p>${r.quickSummary}</p>
            <p class="meta">
              Coverage: ${r.coverageText}
            </p>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderDetailedSummary(results) {
      const container = document.getElementById("detailed-summary-content");

      if (!results.length) {
        container.innerHTML = `
          <div class="empty-state">
            No vaccine logic triggered yet. Once you enter patient details and click 
            <strong>Get Results</strong>, this view will populate with counselling-ready notes by vaccine.
          </div>
        `;
        return;
      }

      let html = "";

      const recommended = results.filter((r) => r.recommended);
      const notRecommended = results.filter((r) => !r.recommended);

      if (recommended.length) {
        html += '<div class="section-title">Recommended vaccines (NACI-aligned)</div>';
        recommended.forEach((r) => {
          html += `
            <div class="vaccine-block">
              <div class="vaccine-block-header">
                <h3>${r.name}</h3>
                <span class="tag">Recommended</span>
              </div>
              <p>${r.detailedSummary}</p>
              <p class="meta">
                Indication: ${r.indicationText}<br/>
                Coverage: ${r.coverageText}
              </p>
            </div>
          `;
        });
      }

      if (notRecommended.length) {
        html += '<div class="section-title" style="margin-top:10px;">Not routinely recommended today</div>';
        notRecommended.forEach((r) => {
          html += `
            <div class="vaccine-block">
              <div class="vaccine-block-header">
                <h3>${r.name}</h3>
                <span class="tag tag-muted">Not routine today</span>
              </div>
              <p>${r.detailedSummary}</p>
              <p class="meta">
                Indication: ${r.indicationText}<br/>
                Coverage (general): ${r.coverageText}
              </p>
            </div>
          `;
        });
      }

      container.innerHTML = html;
    }

    function renderIndicationCoverage(results) {
      const container = document.getElementById("indication-coverage-content");

      if (!results.length) {
        container.innerHTML = `
          <div class="empty-state">
            Once you generate results, this tab will show ‚Äì for each vaccine ‚Äì the distinction between 
            <strong>indication</strong>, <strong>recommendation for this patient</strong>, and 
            <strong>coverage</strong> (public vs private).
          </div>
        `;
        return;
      }

      let html = `
        <table class="indication-table">
          <thead>
            <tr>
              <th style="width:20%;">Vaccine</th>
              <th style="width:32%;">Indication (NACI)</th>
              <th style="width:28%;">Recommended for this patient?</th>
              <th style="width:20%;">Coverage for this patient</th>
            </tr>
          </thead>
          <tbody>
      `;

      results.forEach((r) => {
        html += `
          <tr>
            <td>
              <strong>${r.name}</strong>
            </td>
            <td>
              ${r.indicationText}
              <div class="ref">
                Ref: ${r.naciRef}
              </div>
            </td>
            <td>
              <strong>${r.recommended ? "Yes" : "No / not routine"}</strong><br/>
              ${r.recommendationText}
            </td>
            <td>
              <strong>${
                r.coverageType === "public"
                  ? "Publicly funded"
                  : r.coverageType === "private"
                  ? "Private pay / third-party"
                  : "Program-dependent"
              }</strong><br/>
              ${r.coverageText}
            </td>
          </tr>
        `;
      });

      html += "</tbody></table>";

      container.innerHTML = html;
    }

    function setupTabs() {
      const tabButtons = document.querySelectorAll(".tab-button");
      const panels = document.querySelectorAll(".tab-panel");

      tabButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const tabId = btn.getAttribute("data-tab");

          tabButtons.forEach((b) => b.classList.remove("active"));
          panels.forEach((p) => p.classList.remove("active"));

          btn.classList.add("active");
          const panel = document.getElementById(tabId);
          if (panel) panel.classList.add("active");
        });
      });
    }

    function setupPrintButtons() {
      const printButtons = document.querySelectorAll(".print-button");
      printButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const tabId = btn.getAttribute("data-print-tab");
          const targetPanel = document.getElementById(tabId);
          if (!targetPanel) return;

          const panels = document.querySelectorAll(".tab-panel");
          panels.forEach((p) => p.classList.remove("print-target"));
          targetPanel.classList.add("print-target");

          window.print();

          targetPanel.classList.remove("print-target");
        });
      });
    }

    function clearResults() {
      document.getElementById("quick-summary-content").innerHTML = `
        <div class="empty-state">
          Results cleared. Re-run eligibility to populate this view again.
        </div>
      `;
      document.getElementById("detailed-summary-content").innerHTML = `
        <div class="empty-state">
          Results cleared. Re-run eligibility to populate this view again.
        </div>
      `;
      document.getElementById("indication-coverage-content").innerHTML = `
        <div class="empty-state">
          Results cleared. Re-run eligibility to populate this view again.
        </div>
      `;
      renderMeta(null, null);
    }

    function resetForm() {
      document.getElementById("eligibility-form").reset();
      clearResults();
    }

    document.addEventListener("DOMContentLoaded", () => {
      setupTabs();
      setupPrintButtons();
      clearResults();

      document
        .getElementById("eligibility-form")
        .addEventListener("submit", (event) => {
          event.preventDefault();
          const patient = getPatientFromForm();
          const results = evaluateVaccines(patient);

          renderMeta(patient, results);
          renderQuickSummary(results);
          renderDetailedSummary(results);
          renderIndicationCoverage(results);
        });

      document
        .getElementById("clear-results-btn")
        .addEventListener("click", clearResults);

      document
        .getElementById("reset-form-btn")
        .addEventListener("click", resetForm);
    });
  </script>
</body>
</html>
