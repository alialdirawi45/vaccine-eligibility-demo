<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vaccine Eligibility Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f6;
      color: #222;
    }
    .page {
      max-width: 1200px; /* WIDER PAGE */
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    h1 {
      font-size: 1.7rem;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 8px;
    }
    .top-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 8px;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.8fr) minmax(0, 1.7fr); /* WIDER RIGHT SIDE */
      gap: 16px;
    }
    @media (max-width: 860px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 16px 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }
    .card h2 {
      font-size: 1.1rem;
      margin-top: 0;
      margin-bottom: 8px;
    }
    .card h3 {
      font-size: 1rem;
      margin-top: 0;
      margin-bottom: 8px;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }
    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    input[type="checkbox"] {
      margin-right: 6px;
    }
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 4px 8px;
      margin-bottom: 8px;
    }
    .checkbox-item {
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .checkbox-item input {
      margin: 0;
    }
    .btn-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
      font-weight: 600;
    }
    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .small-btn {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .disclaimer {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 8px;
    }
    .section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
      margin-bottom: 8px;
      margin-top: 12px;
    }
    .section-title span {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .muted {
      color: #6b7280;
      font-size: 0.8rem;
    }
    .no-results {
      font-size: 0.9rem;
      color: #6b7280;
      margin-top: 4px;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #e0f2fe;
      color: #075985;
      font-weight: 600;
      margin-right: 4px;
    }
    #summary-badge {
      font-size: 0.8rem;
      color: #4b5563;
    }
    .section-tagline {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 2px;
      margin-bottom: 6px;
    }
    .top-actions {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 8px;
    }

    .tab-row {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      margin-top: 2px;
    }
    .tab-button {
      background: #e5e7eb;
      color: #111827;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.8rem;
      border: none;
      cursor: pointer;
    }
    .tab-button.active {
      background: #2563eb;
      color: #fff;
    }
    .hidden {
      display: none;
    }

    /* INDICATION TABLE */
    .indication-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      margin-top: 4px;
    }
    .indication-table th,
    .indication-table td {
      border: 1px solid #e5e7eb;
      padding: 4px 6px;
      vertical-align: top;
    }
    .indication-table th {
      background: #f3f4f6;
      text-align: left;
    }
    .vaccine-col {
      font-weight: 600;
      width: 20%;
    }
    .yes-highlight {
      display: inline-block;
      background: #fef08a;
      padding: 1px 6px;
      border-radius: 999px;
      font-weight: 700;
      color: #854d0e;
      font-size: 0.8rem;
    }
    .no-dim {
      color: #6b7280;
      font-weight: 600;
      font-size: 0.8rem;
    }
    .small-ref {
      display: block;
      font-size: 0.72rem;
      color: #6b7280;
      margin-top: 2px;
    }

    /* PRINT SUMMARY AREA */
    #print-area {
      display: none;
      padding: 24px;
      font-size: 0.9rem;
      max-width: 800px;
      margin: 0 auto;
      color: #111827;
    }
    #print-area h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }
    #print-area h2 {
      font-size: 1.1rem;
      margin-top: 18px;
      margin-bottom: 4px;
    }
    #print-area table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 0.9rem;
    }
    #print-area th,
    #print-area td {
      border: 1px solid #d1d5db;
      padding: 6px 8px;
      vertical-align: top;
    }
    #print-area th {
      background: #f3f4f6;
      text-align: left;
    }
    #print-area .small {
      font-size: 0.8rem;
      color: #4b5563;
    }

    @media print {
      body {
        background: #fff;
      }
      .page {
        display: none;
      }
      #print-area {
        display: block;
      }
    }

    footer {
      margin-top: 8px;
      text-align: center;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    /* ---------- DARK MODE ---------- */
    body.dark {
      background: #0f172a;
      color: #e5e7eb;
    }
    body.dark .card {
      background: #020617;
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    }
    body.dark .subtitle,
    body.dark .disclaimer,
    body.dark .muted,
    body.dark footer {
      color: #9ca3af;
    }
    body.dark input[type="number"],
    body.dark input[type="text"],
    body.dark select {
      background: #111827;
      color: #e5e7eb;
      border-color: #374151;
    }
    body.dark .section-title {
      border-bottom-color: #1f2937;
    }
    body.dark .tab-button {
      background: #111827;
      color: #e5e7eb;
    }
    body.dark .tab-button.active {
      background: #2563eb;
      color: #fff;
    }
    body.dark .badge {
      background: #1d4ed8;
      color: #dbeafe;
    }
    body.dark .indication-table th {
      background: #111827;
    }
    body.dark .indication-table th,
    body.dark .indication-table td {
      border-color: #1f2937;
    }
    body.dark #print-area {
      background: #fff;
      color: #111827;
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Vaccine Eligibility Tool</h1>
    <div class="subtitle">
      Influenza, COVID-19, Pneumococcal (PCV20), Shingrix, RSV (Abrysvo), Tdap/Td (Adacel), HPV (Gardasil 9).
    </div>
    <div class="top-bar">
      <button type="button" id="theme-toggle" class="secondary small-btn">Dark mode</button>
    </div>

    <div class="layout">
      <!-- LEFT: INPUT -->
      <div class="card">
        <h2>Patient information</h2>
        <form id="eligibility-form">
          <label for="age">Age (years)</label>
          <input type="number" id="age" name="age" min="0" max="120" placeholder="e.g., 72" required>

          <label for="sex">Sex at birth</label>
          <select id="sex" name="sex">
            <option value="unspecified">Select...</option>
            <option value="female">Female</option>
            <option value="male">Male</option>
            <option value="other">Other / not listed</option>
          </select>

          <label class="checkbox-item" style="margin-top: 4px; margin-bottom: 8px;">
            <input type="checkbox" id="pregnantWindow" value="pregnantWindow">
            Pregnant in weeks 32–36
          </label>

          <label>Medical / risk factors (simplified)</label>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" value="immunocompromised">
              Immunocompromised
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="diabetes">
              Diabetes
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="ckd">
              CKD / dialysis
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="chronic-heart">
              Chronic heart disease
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="chronic-lung">
              Chronic lung disease (e.g., COPD, asthma)
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="liver">
              Chronic liver disease
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="asplenia">
              Asplenia / hyposplenia
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="ltc">
              Long-term care / retirement home
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="indigenous">
              Indigenous
            </label>
            <label class="checkbox-item">
              <input type="checkbox" value="smoker">
              Current smoker
            </label>
          </div>

          <div class="btn-row">
            <button type="submit">Check vaccines</button>
            <button type="button" class="secondary" id="reset-btn">Reset</button>
          </div>

          <div class="disclaimer">
            This tool does not store any data. Vaccine decisions should be confirmed with current NACI guidance,
            the Canadian Immunization Guide, provincial schedules, and product monographs.
          </div>
        </form>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="card">
        <div class="section-title">
          <h2>Recommendations</h2>
          <span id="summary-badge"></span>
        </div>

        <div class="tab-row">
          <button type="button" class="tab-button active" id="tab-quick">Quick summary</button>
          <button type="button" class="tab-button" id="tab-detailed">Indication, recommendation &amp; coverage</button>
        </div>

        <div class="top-actions">
          <button type="button" id="print-btn" disabled>Print quick summary</button>
        </div>

        <!-- QUICK SUMMARY TAB CONTENT -->
        <div id="quick-summary"></div>

        <!-- INDICATION & COVERAGE TAB CONTENT -->
        <div id="detailed-results" class="hidden">
          <div class="section-tagline">
            For each vaccine, this table shows: <strong>Indication</strong> (from NACI), whether it is
            <strong>recommended for this patient</strong> (Yes/No), and <strong>coverage</strong> (public vs private/out-of-pocket).
            “Yes” in the recommendation column is highlighted. Shingrix, Prevnar, and RSV will always appear at the top.
          </div>
          <div id="indication-coverage"></div>
        </div>

        <p class="disclaimer">
          Categories:
          <br>• <strong>Publicly funded – pharmacy:</strong> funded and typically available in community pharmacies.
          <br>• <strong>Publicly funded – MD/public health:</strong> part of provincial programs, usually not billed through pharmacy.
          <br>• <strong>Private-pay:</strong> patient usually pays; some plans may reimburse.
          <br><br>
          NACI quotes are shortened excerpts – refer to the Canadian Immunization Guide and NACI statements for full details.
        </p>
      </div>
    </div>

    <!-- References card -->
    <div class="card">
      <h2>Key references</h2>
      <ul class="disclaimer">
        <li>Canadian Immunization Guide – chapters on Influenza, COVID-19, Pneumococcal, Herpes Zoster, HPV, RSV, and Immunization of Adults.</li>
        <li>NACI statements and updates on seasonal influenza vaccines, COVID-19 vaccines, pneumococcal vaccines (PCV20), zoster vaccines (RZV), RSV vaccines, and HPV vaccines.</li>
        <li>Ontario Ministry of Health – publicly funded immunization schedules and program policy (e.g., Shingrix 65–70, HPV school program, RSV and pneumococcal programs).</li>
        <li>NAPRA National Drug Schedules – classification of vaccines as Schedule II and province-specific adaptations (e.g., PCV20, RSV, HPV, zoster, Tdap).</li>
      </ul>
    </div>

    <footer>
      Created by Ali Al-Dirawi
    </footer>
  </div>

  <!-- PRINTABLE SUMMARY AREA -->
  <div id="print-area"></div>

  <script>
    // ---------- Constants ------------------------------------------------

    const RISK_LABELS = {
      'immunocompromised': 'Immunocompromised',
      'diabetes': 'Diabetes',
      'ckd': 'Chronic kidney disease / dialysis',
      'chronic-heart': 'Chronic heart disease',
      'chronic-lung': 'Chronic lung disease (e.g., COPD, asthma)',
      'liver': 'Chronic liver disease',
      'asplenia': 'Asplenia / hyposplenia',
      'ltc': 'Long-term care / retirement home',
      'indigenous': 'Indigenous',
      'smoker': 'Current smoker'
    };

    const PRICE_PREVNAR20 = 145;
    const PRICE_SHINGRIX = 205;
    const PRICE_ABRYSVO = 290;
    const PRICE_GARDASIL9 = 225;
    const PRICE_ADACEL = 70;

    const PRIORITY_ORDER = {
      'pcv20': 1,
      'pcv20-private': 1,
      'shingrix-public': 1,
      'shingrix-private': 1,
      'rsv-public': 1,
      'rsv-private': 1,
      'rsv-preg': 1,
      'influenza': 2,
      'covid': 2,
      'hpv-public': 3,
      'hpv-private': 3,
      'tdap': 3
    };

    function getPriority(v) {
      return PRIORITY_ORDER[v.id] !== undefined ? PRIORITY_ORDER[v.id] : 99;
    }

    const QUICK_GROUPS = [
      { key: 'pcv20', label: 'Prevnar 20 (PCV20)', matchIds: ['pcv20', 'pcv20-private'] },
      { key: 'shingrix', label: 'Shingrix (RZV)', matchIds: ['shingrix-public', 'shingrix-private'] },
      { key: 'rsv', label: 'RSV vaccine – Abrysvo', matchIds: ['rsv-public', 'rsv-private', 'rsv-preg'] },
      { key: 'influenza', label: 'Influenza', matchIds: ['influenza'] },
      { key: 'covid', label: 'COVID-19', matchIds: ['covid'] },
      { key: 'hpv', label: 'HPV (Gardasil 9)', matchIds: ['hpv-public', 'hpv-private'] },
      { key: 'tdap', label: 'Tdap/Td (Adacel)', matchIds: ['tdap'] }
    ];

    const INDIC_ORDER = {
      'shingrix': 1,
      'pcv20': 1,
      'rsv': 1,
      'influenza': 2,
      'covid': 2,
      'hpv': 3,
      'tdap': 3
    };

    let lastProfile = null;
    let lastVaccines = [];

    function getPatientProfile() {
      const age = parseInt(document.getElementById('age').value, 10);
      const sex = document.getElementById('sex').value;
      const pregnantWindow = document.getElementById('pregnantWindow').checked;

      const checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
      const risks = [];
      checkboxes.forEach(cb => {
        if (cb.checked) risks.push(cb.value);
      });

      return { age, sex, pregnantWindow, risks };
    }

    function hasRisk(profile, key) {
      return profile.risks.includes(key);
    }

    function isHighRiskAdult(profile) {
      return hasRisk(profile, 'chronic-heart') ||
             hasRisk(profile, 'chronic-lung') ||
             hasRisk(profile, 'diabetes') ||
             hasRisk(profile, 'ckd') ||
             hasRisk(profile, 'liver') ||
             hasRisk(profile, 'asplenia') ||
             hasRisk(profile, 'immunocompromised') ||
             hasRisk(profile, 'ltc');
    }

    function uniqueVaccines(vList) {
      const seen = new Set();
      const unique = [];
      vList.forEach(v => {
        if (!seen.has(v.id)) {
          seen.add(v.id);
          unique.push(v);
        }
      });
      return unique;
    }

    function collapsePublicPrivate(vaxList) {
      let filtered = [...vaxList];

      QUICK_GROUPS.forEach(group => {
        const hasPublic = filtered.some(
          v =>
            group.matchIds.includes(v.id) &&
            (v.category === 'pharmacy-funded' || v.category === 'public-nonpharmacy')
        );

        if (hasPublic) {
          filtered = filtered.filter(
            v => !(group.matchIds.includes(v.id) && v.category === 'private')
          );
        }
      });

      return filtered;
    }

    function evaluateVaccines(profile) {
      const vax = [];
      const age = profile.age;

      if (Number.isNaN(age) || age < 0) return vax;

      const isAdult = age >= 18;
      const is60plus = age >= 60;
      const is65plus = age >= 65;
      const is75plus = age >= 75;
      const highRisk = isHighRiskAdult(profile);
      const pregnantWindow = profile.pregnantWindow;

      if (age >= 2) {
        vax.push({
          id: 'influenza',
          name: 'Influenza (inactivated seasonal)',
          category: 'pharmacy-funded',
          funding: 'Publicly funded in Ontario pharmacies each influenza season.',
          reason: 'Annual influenza vaccine is recommended for everyone ≥6 months; adults, especially ≥65 or with chronic conditions, are priority groups.',
          schedule: '1 IM dose every influenza season; consider high-dose or adjuvanted options in adults ≥65 per local guidance.',
          napraSchedule: 'Schedule II – vaccine in national routine programs.',
          rxInfo: 'Prescription generally not required for pharmacist administration; pharmacist assessment needed.',
          naciQuote: '“Influenza vaccine should be offered annually to anyone 6 months of age and older who does not have a contraindication.”',
          naciRef: 'NACI Statement on Seasonal Influenza Vaccine 2025–2026',
          notes: '',
          pharmacistCanInject: true,
          approxPrice: null
        });
      }

      if (age >= 18) {
        let reason = 'Annual updated COVID-19 vaccine is recommended for adults, with strongest emphasis on adults ≥65 and those with chronic conditions or immunocompromise.';
        if (is65plus || highRisk) {
          reason += ' This patient meets higher-risk criteria (age ≥65 and/or chronic disease).';
        }
        vax.push({
          id: 'covid',
          name: 'COVID-19 (updated formulation)',
          category: 'pharmacy-funded',
          funding: 'Publicly funded in Ontario pharmacies under the seasonal COVID-19 program.',
          reason,
          schedule: 'Generally 1 dose per season with ≥6 months from previous dose; follow current NACI/Ontario guidance for exact interval and extra doses in very high-risk groups.',
          napraSchedule: 'Schedule II – vaccine in national immunization programs.',
          rxInfo: 'Prescription usually not required for pharmacist administration; pharmacist assessment needed.',
          naciQuote: '“NACI recommends that all individuals 6 months of age and older should receive a COVID-19 vaccine dose every year, with additional doses for some high-risk groups.”',
          naciRef: 'NACI COVID-19 seasonal guidance',
          notes: '',
          pharmacistCanInject: true,
          approxPrice: null
        });
      }

      if (isAdult) {
        const highRiskAgain = isHighRiskAdult(profile);
        if (is65plus || highRiskAgain) {
          vax.push({
            id: 'pcv20',
            name: 'Pneumococcal conjugate 20-valent (PCV20 / Prevnar 20)',
            category: 'public-nonpharmacy',
            funding: 'Publicly funded for adults ≥65 and selected high-risk adults <65 (via physician / public health, not usually billed through pharmacy).',
            reason: is65plus
              ? 'Adult ≥65 – routine PCV20 dose recommended by NACI; eligible for provincial funding.'
              : 'Adult <65 with chronic or immunocompromising condition – NACI recommends conjugate pneumococcal vaccination.',
            schedule: '1 IM dose PCV20 for most adults; follow local guidance if prior PPSV23 or other PCV products were given.',
            napraSchedule: 'Schedule II in some provinces – treated as a vaccine requiring pharmacist assessment.',
            rxInfo: 'Prescription may or may not be required depending on province/insurer; confirm local policy.',
            naciQuote: '“Pneu-C-20 vaccine is recommended for all adults 65 years of age and older.”',
            naciRef: 'CIG – Immunization of adults / Pneumococcal chapter',
            notes: 'Assumes Ontario-style funding (PCV20 publicly funded for 65+ and certain high-risk adults).',
            pharmacistCanInject: true,
            approxPrice: null
          });
        }
      }

      if (age >= 18) {
        const isImmuno = hasRisk(profile, 'immunocompromised');
        const is50plus = age >= 50;

        if (age >= 65 && age <= 70) {
          vax.push({
            id: 'shingrix-public',
            name: 'Recombinant zoster vaccine (Shingrix – RZV)',
            category: 'public-nonpharmacy',
            funding: 'Publicly funded in Ontario for adults 65–70 years as a 2-dose series, usually via primary care / public health.',
            reason: 'Age 65–70 – NACI recommends RZV for adults ≥50; Ontario funds a 2-dose series at 65–70.',
            schedule: '2 IM doses, 2–6 months apart.',
            napraSchedule: 'Schedule II – non-live recombinant zoster vaccine.',
            rxInfo: 'Schedule II vaccine, so a prescription is generally not required for pharmacist dispensing.',
            naciQuote: '“Herpes zoster vaccines are generally recommended for adults 50 years of age and older.”',
            naciRef: 'CIG – Herpes zoster (shingles) vaccine chapter',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: null
          });
        }

        if (is50plus || isImmuno) {
          const reasonParts = [];
          if (is50plus) reasonParts.push('Adult ≥50 – routine RZV prevention of shingles and post-herpetic neuralgia.');
          if (isImmuno) reasonParts.push('Immunocompromised adult – high risk of herpes zoster and complications.');
          vax.push({
            id: 'shingrix-private',
            name: 'Recombinant zoster vaccine (Shingrix – RZV)',
            category: 'private',
            funding: 'Outside the 65–70 funded window and some high-risk programs, RZV is generally private-pay, though some drug plans cover it.',
            reason: reasonParts.join(' '),
            schedule: '2 IM doses, usually 2–6 months apart (can shorten to 1–2 months in some high-risk situations).',
            napraSchedule: 'Schedule II – non-live recombinant zoster vaccine.',
            rxInfo: 'As a Schedule II vaccine, a prescription is generally not required; some insurers may request documentation.',
            naciQuote: '“NACI strongly recommends that individuals 18 years of age and older who are or will be immunocompromised should receive two doses of RZV.”',
            naciRef: 'NACI updated recommendations on herpes zoster vaccination',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: PRICE_SHINGRIX
          });
        }
      }

      if (age >= 60 || pregnantWindow) {
        const is60plus2 = age >= 60;
        const is75plus2 = age >= 75;
        const highRisk2 = isHighRiskAdult(profile);
        const isVeryHighRiskOlder = is75plus2 || (is60plus2 && (highRisk2 || hasRisk(profile, 'ltc')));

        if (isVeryHighRiskOlder) {
          vax.push({
            id: 'rsv-public',
            name: 'RSV vaccine – Abrysvo (RSVpreF)',
            category: 'public-nonpharmacy',
            funding: 'Public RSV programs (e.g., adults ≥75 and selected high-risk 60–74, often via MD / public health).',
            reason: 'Older adult with high risk for severe RSV (age ≥75 and/or LTC / chronic comorbidities).',
            schedule: 'Single IM dose (0.5 mL) before or during RSV season; currently no routine booster schedule.',
            napraSchedule: 'Schedule II – RSV vaccines.',
            rxInfo: 'Typically does not require a prescription for pharmacist administration in provinces where pharmacists can give RSV vaccines.',
            naciQuote: '“A 0.5 mL dose of RSVpreF should be administered intramuscularly… the standard schedule for individuals 60 years of age and older is one dose.”',
            naciRef: 'NACI updated guidance on RSV vaccines in older adults',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: null
          });
        } else if (is60plus2) {
          vax.push({
            id: 'rsv-private',
            name: 'RSV vaccine – Abrysvo (RSVpreF)',
            category: 'private',
            funding: 'Adults 60–74 without provincial program eligibility often access RSV vaccine as private-pay (some plans may cover).',
            reason: 'Adult ≥60 without listed very high-risk criteria – may benefit from a single RSV dose based on shared decision-making.',
            schedule: 'Single IM dose (0.5 mL) before / during RSV season.',
            napraSchedule: 'Schedule II – RSV vaccines.',
            rxInfo: 'Typically does not require a prescription for pharmacist administration; insurers may request one.',
            naciQuote: '“A single 0.5 mL dose of RSVpreF (Abrysvo) is administered intramuscularly in adults 60 years of age and older.”',
            naciRef: 'CIG – RSV vaccine chapter',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: PRICE_ABRYSVO
          });
        }

        if (pregnantWindow) {
          vax.push({
            id: 'rsv-preg',
            name: 'RSV vaccine – Abrysvo (maternal use)',
            category: 'public-nonpharmacy',
            funding: 'In some jurisdictions, a single dose in late pregnancy (e.g., 32–36 weeks) is publicly funded to protect the infant.',
            reason: 'Pregnant person in weeks 32–36 – maternal RSV vaccination can protect the infant during their first RSV season.',
            schedule: 'Single IM dose in late pregnancy; timing and eligibility are jurisdiction-specific.',
            napraSchedule: 'Schedule II – vaccine; use in pregnancy per NACI guidance.',
            rxInfo: 'Typically arranged via prenatal care / public health clinics.',
            naciQuote: 'NACI supports maternal RSV vaccination in a defined gestational window to protect infants during their first RSV season.',
            naciRef: 'NACI RSV guidance – maternal vaccination',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: null
          });
        }
      }

      if (isAdult) {
        vax.push({
          id: 'tdap',
          name: 'Tdap / Td (tetanus–diphtheria ± pertussis) – Adacel',
          category: 'public-nonpharmacy',
          funding: 'Td/Tdap boosters are publicly funded; in Ontario, one Tdap booster is recommended for adults ≥18, plus one each pregnancy.',
          reason: 'All adults should receive one dose of Tdap in adulthood and tetanus/diphtheria boosters every 10 years; each pregnancy should receive Tdap.',
          schedule: 'If not yet received in adulthood: 1 dose Tdap now, then Td/Tdap every 10 years. In pregnancy: 1 Tdap each pregnancy, ideally 27–32 weeks.',
          napraSchedule: 'Schedule II – vaccines (tetanus, diphtheria, pertussis).',
          rxInfo: 'As a Schedule II vaccine, a prescription is generally not required; usually administered via public health / MD offices.',
          naciQuote: '“All adults (18 years of age and older) should receive one dose of acellular pertussis-containing vaccine (Tdap) if not previously received during adulthood.”',
          naciRef: 'CIG – Immunization of adults / Pertussis-containing vaccines',
          notes: '',
          pharmacistCanInject: false,
          approxPrice: null
        });
      }

      if (age >= 9 && age <= 45) {
        if (age >= 12 && age <= 17) {
          vax.push({
            id: 'hpv-public',
            name: 'HPV vaccine – Gardasil 9',
            category: 'public-nonpharmacy',
            funding: 'Publicly funded school-based HPV program (grade 7–8 with catch-up through secondary school; usually via school clinics / public health).',
            reason: 'Adolescent in the typical Ontario school program window – eligible for publicly funded HPV series if not already completed.',
            schedule: 'Typically 2-dose schedule in younger adolescents (e.g., 0 and 6–12 months) or 1-dose approaches per updated NACI guidance; confirm current local schedule.',
            napraSchedule: 'Schedule II – HPV vaccine.',
            rxInfo: 'No prescription required as a Schedule II vaccine; school / public health programs usually deliver publicly funded doses.',
            naciQuote: '“NACI strongly recommends HPV vaccination for all individuals 9 to 26 years of age.”',
            naciRef: 'NACI updated recommendations on HPV vaccines',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: null
          });
        }

        if (age >= 18) {
          const isCore = age <= 26;
          const ageText = isCore
            ? 'Core NACI target group (9–26 years).'
            : 'Age 27–45 – vaccination may be offered based on ongoing risk and shared decision-making.';
          vax.push({
            id: 'hpv-private',
            name: 'HPV vaccine – Gardasil 9',
            category: 'private',
            funding: 'Typically private-pay once outside the school program; some public programs or employer plans may cover certain groups.',
            reason: ageText,
            schedule: 'Updated NACI guidance: 1-dose schedule for many individuals 9–20, 2-dose schedules in older groups; immunocompromised persons generally need 3 doses – check the most recent CIG / NACI table.',
            napraSchedule: 'Schedule II – HPV vaccine.',
            rxInfo: 'As a Schedule II vaccine, a prescription is usually not required for pharmacist administration; insurer rules may still ask for a written prescription.',
            naciQuote: '“9vHPV vaccine is recommended for all individuals 9 to 26 years of age.”',
            naciRef: 'CIG – HPV vaccine chapter / NACI HPV update',
            notes: '',
            pharmacistCanInject: true,
            approxPrice: PRICE_GARDASIL9
          });
        }
      }

      return vax;
    }

    function renderQuickSummary(vaccines) {
      const container = document.getElementById('quick-summary');
      container.innerHTML = '';

      if (!vaccines || vaccines.length === 0) {
        container.innerHTML = '<p class="no-results">No vaccines triggered based on the current input. Adjust age or risk factors and try again.</p>';
        return;
      }

      const eligibleLines = [];
      const notEligibleNames = [];

      QUICK_GROUPS.forEach(group => {
        const groupVaccines = vaccines.filter(v => group.matchIds.includes(v.id));
        if (groupVaccines.length === 0) {
          notEligibleNames.push(group.label);
        } else {
          const v = groupVaccines[0];

          let fundingText = '';
          let patientCostText = '';
          let priceText = '';

          if (v.category === 'pharmacy-funded') {
            fundingText = 'Publicly funded at pharmacy.';
            patientCostText = '$0 (no out-of-pocket cost).';
          } else if (v.category === 'public-nonpharmacy') {
            fundingText = 'Publicly funded via family doctor / public health.';
            patientCostText = '$0 (no out-of-pocket cost; not billed through pharmacy).';
          } else if (v.category === 'private') {
            fundingText = 'Not publicly funded for this patient (private-pay).';
            patientCostText = 'Patient pays out-of-pocket or uses private insurance.';
          }

          if (v.category === 'private' && v.approxPrice) {
            priceText = ` Approx. price: $${v.approxPrice} per dose.`;
          }

          let line = `<li><strong>${group.label}</strong> – ${fundingText} ${patientCostText}`;
          if (priceText) line += ` ${priceText}`;
          line += '</li>';

          eligibleLines.push(line);
        }
      });

      let html = '';
      if (eligibleLines.length > 0) {
        html += '<h3>Eligible vaccines</h3><ul>' + eligibleLines.join('') + '</ul>';
      }

      if (notEligibleNames.length > 0) {
        html += `<h3>Not currently recommended for this patient</h3>
                 <p class="muted">${notEligibleNames.join(', ')}</p>`;
      }

      container.innerHTML = html;
    }

    function evaluateIndicationCoverage(profile) {
      const age = profile.age;
      if (Number.isNaN(age) || age < 0) return [];

      const isAdult = age >= 18;
      const is60plus = age >= 60;
      const is65plus = age >= 65;
      const is75plus = age >= 75;
      const highRisk = isHighRiskAdult(profile);
      const immuno = hasRisk(profile, 'immunocompromised');
      const pregnantWindow = profile.pregnantWindow;

      const rows = [];

      function coverageText({ publicPharm = false, publicMD = false, privatePay = false }) {
        if (publicPharm) return 'Yes – publicly funded at pharmacy.';
        if (publicMD) return 'Yes – publicly funded (usually via family doctor or public health).';
        if (privatePay) return 'No public coverage – private pay or third-party insurance.';
        return 'No public coverage for this patient.';
      }

      {
        const indicated = age >= 1;
        const recommended = age >= 2;
        const cov = recommended ? coverageText({ publicPharm: true }) : coverageText({ publicMD: true });
        rows.push({
          key: 'influenza',
          name: 'Influenza',
          indicated,
          indicationText: 'NACI: annual influenza vaccine for everyone ≥6 months of age.',
          indicationRef: 'NACI/Canadian Immunization Guide – Influenza chapter',
          recommended,
          recommendationText: recommended
            ? 'Yes – annual dose recommended for this patient.'
            : 'Not recommended in this simplified tool (age <2).',
          recommendationRef: 'NACI seasonal influenza recommendations',
          coverage: cov
        });
      }

      {
        const indicated = age >= 6;
        const recommended = age >= 18;
        const cov = recommended ? coverageText({ publicPharm: true }) : coverageText({ publicMD: true });
        rows.push({
          key: 'covid',
          name: 'COVID-19',
          indicated,
          indicationText: 'NACI: seasonal COVID-19 vaccine for individuals ≥6 months of age.',
          indicationRef: 'NACI COVID-19 guidance',
          recommended,
          recommendationText: recommended
            ? 'Yes – annual updated dose recommended for adults, with emphasis on older and high-risk patients.'
            : 'Not covered in this adult-focused tool (under 18).',
          recommendationRef: 'NACI COVID-19 seasonal recommendations',
          coverage: cov
        });
      }

      {
        const indicated = age >= 1;
        const recommended = is65plus || highRisk;
        const cov = recommended
          ? coverageText({ publicMD: true })
          : coverageText({ privatePay: true });

        rows.push({
          key: 'pcv20',
          name: 'Prevnar 20 (PCV20)',
          indicated,
          indicationText: 'NACI: pneumococcal conjugate vaccines are used for certain children and adults, especially ≥65 or with chronic/immunocompromising conditions.',
          indicationRef: 'CIG – Pneumococcal vaccine chapter',
          recommended,
          recommendationText: recommended
            ? 'Yes – recommended for adults ≥65 or adults <65 with high-risk conditions.'
            : 'No – not routinely recommended for healthy adults <65 in this simplified tool.',
          recommendationRef: 'NACI guidance on adult pneumococcal vaccination',
          coverage: cov
        });
      }

      {
        const indicated = (age >= 50) || (immuno && isAdult);
        const recommended = indicated;
        const publicWindow = age >= 65 && age <= 70;
        const cov = publicWindow
          ? coverageText({ publicMD: true })
          : coverageText({ privatePay: true });

        rows.push({
          key: 'shingrix',
          name: 'Shingrix (RZV)',
          indicated,
          indicationText: 'NACI: RZV for adults ≥50 years and for immunocompromised adults ≥18 years.',
          indicationRef: 'CIG/NACI – Herpes zoster vaccine chapter',
          recommended,
          recommendationText: recommended
            ? 'Yes – recommended for this patient based on age ≥50 and/or immunocompromised status.'
            : 'No – not indicated in this age group.',
          recommendationRef: 'NACI herpes zoster vaccine recommendations',
          coverage: cov + (publicWindow ? ' (Ontario 65–70 program).' : ' Public funding may exist only in specific age/risk programs.')
        });
      }

      {
        const indicated = (age >= 60) || pregnantWindow;
        const recommended = indicated;
        const is60plus2 = age >= 60;
        the same page while testing.
::contentReference[oaicite:0]{index=0}
